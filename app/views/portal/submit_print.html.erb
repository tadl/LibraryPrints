<!-- app/views/portal/submit_print.html.erb -->
<main class="container my-5">
  <h1 class="mb-4">Request a 3D Print</h1>

  <%= form_tag submit_print_path,
        multipart: true,
        local: true,
        data: { turbo: false } do %>

    <!-- Name -->
    <div class="card mb-4">
      <div class="card-header">
        <h4 class="mb-0">Name</h4>
      </div>
      <div class="card-body">
        <div class="row g-3">
          <div class="col-md-6">
            <%= label_tag 'patron[first_name]', 'First Name', class: 'form-label' %>
            <%= text_field_tag 'patron[first_name]',
                  params.dig(:patron, :first_name),
                  id: 'patron_first_name',
                  class: 'form-control',
                  required: true %>
          </div>
          <div class="col-md-6">
            <%= label_tag 'patron[last_name]', 'Last Name', class: 'form-label' %>
            <%= text_field_tag 'patron[last_name]',
                  params.dig(:patron, :last_name),
                  id: 'patron_last_name',
                  class: 'form-control',
                  required: true %>
          </div>
        </div>
        <div class="mt-3">
          <%= label_tag 'patron[email]', 'Email Address', class: 'form-label' %>
          <%= email_field_tag 'patron[email]',
                params.dig(:patron, :email),
                id: 'patron_email',
                class: 'form-control',
                required: true %>
        </div>
      </div>
    </div>

    <!-- Model -->
    <div class="card mb-4">
      <div class="card-header">
        <h4 class="mb-0">Model</h4>
      </div>
      <div class="card-body">
        <%= label_tag 'job[model_file]', 'Upload a Model File', class: 'form-label' %>
        <%= file_field_tag 'job[model_file]',
              accept: '.stl,.obj,.3mf',
              id: 'job_model_file',
              class: 'form-control' %>
        <div class="form-text">Allowed types: STL, OBJ, 3MF.</div>
        <br/>
        <%= label_tag 'job[url]', 'Or paste a URL to a Model here', class: 'form-label' %>
        <%= url_field_tag 'job[url]',
              params.dig(:job, :url),
              id: 'job_url',
              class: 'form-control' %>
      </div>
    </div>

    <!-- Filament Color -->
    <div class="card mb-4">
      <div class="card-header">
        <h4 class="mb-0">Filament Color</h4>
      </div>
      <div class="card-body">
        <%= label_tag 'job[filament_color]', 'Choose a Color', class: 'form-label' %>
        <%= select_tag 'job[filament_color]',
              options_from_collection_for_select(
                FilamentColor.all.order(:position), :code, :name,
                params.dig(:job, :filament_color)
              ),
              include_blank: 'Select color',
              id: 'job_filament_color',
              class: 'form-select' %>
      </div>
    </div>

    <!-- Notes -->
    <div class="card mb-4">
      <div class="card-header">
        <h4 class="mb-0">Notes</h4>
      </div>
      <div class="card-body">
        <%= label_tag 'job[notes]', 'Additional Instructions', class: 'form-label' %>
        <%= text_area_tag 'job[notes]',
              params.dig(:job, :notes),
              id: 'job_notes',
              rows: 4,
              placeholder: 'Any special instructionsâ€¦',
              class: 'form-control' %>
      </div>
    </div>

    <!-- Pickup Location -->
    <div class="card mb-4">
      <div class="card-header">
        <h4 class="mb-0">Pickup Location</h4>
      </div>
      <div class="card-body">
        <%= label_tag 'job[pickup_location]', 'Where will you pick up your print?', class: 'form-label' %>
        <%= select_tag 'job[pickup_location]',
              options_for_select(
                PickupLocation.active.order(:position).pluck(:name, :code),
                params.dig(:job, :pickup_location) || 'wood'
              ),
              id: 'job_pickup_location',
              class: 'form-select' %>
        <span class="help-text">We will try to print your object at your pickup library. Only locations with active printers are available as pickup libraries.</span>
      </div>
    </div>

    <!-- CAPTCHA -->
    <div class="card mb-4">
      <div class="card-header">
        <h4 class="mb-0">CAPTCHA</h4>
      </div>
      <div class="card-body">
        <%= recaptcha_tags %>
        <% if @job.errors[:recaptcha].present? %>
          <div class="text-danger small mt-1"><%= @job.errors[:recaptcha].join(", ") %></div>
        <% end %>
        <span class="help-text">This question is for testing whether or not you are a human visitor and to prevent automated spam submissions.</span>
      </div>
    </div>

    <!-- Submit -->
    <div class="text-end">
      <%= submit_tag 'Submit Print Request', class: 'btn btn-primary btn-lg' %>
    </div>

    <p class="form-text text-muted mt-4">
      After receiving your submission, we'll get back to you within 48 hours (usually much sooner) with
      details on print time, filament usage, cost, or any questions we have.
    </p>
  <% end %>
</main>
